#!/bin/bash

set -e

if [ -z "$2" ]
then
  echo No git tag, skipping.
  exit 0
fi

PROJECT_ROOT=`git rev-parse --show-toplevel`
pushd $PROJECT_ROOT >/dev/null

#
# Specifically for CircleCI. Retag smartcontract/explorer:latest to smartcontract/explorer:0.9.1, for example.
#
BRANCH_TAG=`tools/bin/branch2tag ${1}` # ie: develop or latest
export DOCKER_TAG=`tools/bin/gittag2dockertag ${2}` # aka GIT_TAG. explorer-v0.9.1 -> 0.9.1
docker tag smartcontract/explorer:${BRANCH_TAG} smartcontract/explorer:${DOCKER_TAG}

# docker push smartcontract/explorer:0.9.1, since DOCKER_TAG=0.9.1
cd explorer && make dockerpush
